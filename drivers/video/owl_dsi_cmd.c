/*
 * owl_dsi.c - OWL display driver
 *
 * Copyright (C) 2012, Actions Semiconductor Co. LTD.
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published
 * by the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 */
#include <libfdt_env.h>
#include <fdtdec.h>
#include <fdt.h>
#include <libfdt.h>

#include <asm/arch/actions_reg_owl.h>
#include <asm/arch/owl_lcd.h>
#include <asm/io.h>
#include <asm/arch/pwm_backlight.h>
#include <asm/gpio.h>

#include <common.h>
#include <malloc.h>

#include <video_fb.h>
#include <owl_dss.h>
#include <owl_dsi.h>
#include <linux/list.h>
#include <linux/fb.h>

DECLARE_GLOBAL_DATA_PTR;

#define PICOS2KHZ(a) (1000000000UL/(a))
#define KHZ2PICOS(a) (1000000000UL/(a))


#define LONG_CMD_MODE 0x39
#define SHORT_CMD_MODE 0x05

#define POWER_MODE  0x01

void send_long_cmd(char *pcmd, int cnt)
{
	dsihw_send_long_packet(LONG_CMD_MODE,cnt,(unsigned int *)pcmd,POWER_MODE);	
}

void send_short_cmd(int cmd)
{
	dsihw_send_short_packet(SHORT_CMD_MODE,cmd,POWER_MODE);  
}

void send_short_cmd_1(int cmd, int singnal)
{
	dsihw_send_short_packet(singnal,cmd,POWER_MODE);  
}

/*


2. 长包格式
	pakg[0] cmd
	pakg[1] data1
	pakg[2] data2
	.       .
	.       .
	send_long_cmd(pakg, 4); 第一个参数是指针，第二个参数是传输个数
	
3. 短包格式
	send_short_cmd(cmd);
	exp： send_short_cmd(0x11);
	
4. 需要用到毫秒延时
	mdelay(100); //100毫秒的延时
*/
void send_cmd(void)
{
	char pakg[100];
/*	
	start_long_cmd();
	pakg[0] = 0xbf; 
	pakg[1] = 0x93; 
	pakg[2] = 0x61; 
	pakg[3] = 0xf4; 
	send_long_cmd(pakg, 4);
	pakg[0] = 0xbf; 
	pakg[1] = 0x93; 
	send_long_cmd(pakg, 2);	
	end_long_cmd();
	
*/	
	//char [] = {};
    char a[] = {0xF0,0x55,0xAA,0x52,0x08,0x00 };
	char b[] = {0xB2,0x25};
	char c[] = {0xBB,0x63,0x63};
	
	char d[] = {0xBC,0x0F,0x00};
	char e[] = {0xBD,0x01,0x40, 0x0D,0x06};
	char f[] = {0xC8,0x83};
	char g[] = {0xF0,0x55,0xAA,0x52,0x08,0x01};
	char h[] = {0xB3,0x28};
	char i[] = {0xB4,0x14};
	char j[] = {0xB9,0x44};
	char k[] = {0xBC,0x78,0x00};
	char l[] = {0xBD,0x78,0x00};
	char n3[] = {0xC7,0x00,0x80,0x00};
	char m[] = {0xCA,0x00};
	char o[] = {0xCE,0x04};
	char p[] = {0xF0,0x55,0xAA,0x52,0x08,0x02};
	char q[] = {0xB0,0x42};
	char r[] = {0xD1,0x00,0x00,0x00,0x18,0x00,0x3E,0x00,0x5A,0x00,0x73,0x00,0x9A,0x00,0xB9,0x00,0xEB};
	char s[] = {0xD2,0x01,0x13,0x01,0x53,0x01,0x85,0x01,0xCF,0x02,0x0B,0x02,0x0C,0x02,0x43,0x02,0x7D};
	char t[] = {0xD3,0x02,0xA1,0x02,0xD4,0x02,0xF6,0x03,0x26,0x03,0x43,0x03,0x6C,0x03,0x86,0x03,0xA1};
	char u[] = {0xD4,0x03,0xBA,0x03,0xFF};
	char v[] = {0xF0,0x55,0xAA,0x52,0x08,0x03};
	char w[] = {0xB0,0x00,0x00,0x00,0x00};
	char x[] = {0xB1,0x00,0x00,0x00,0x00};
	char y[] = {0xB2,0x01,0x00,0x09,0x03,0x00,0x34,0x48};
	char z[] = {0xB3,0x01,0x00,0x08,0x03,0x00,0x34,0x48};
	char a1[] = {0xB6,0xF0,0x05,0x04,0x05,0x00,0x00,0x00,0x00,0x34,0x48};
	char b1[] = {0xB7,0xF0,0x05,0x04,0x05,0x00,0x00,0x00,0x00,0x34,0x48};
	char c1[] = {0xBA,0x84,0x04,0x00,0x07,0x01,0x34,0x48};
	char d1[] = {0xBB,0x84,0x04,0x00,0x06,0x01,0x34,0x48};
	char e1[] = {0xC4,0x10,0x00};
	char f1[] = {0xC5,0x00,0x00};
	char g1[] = {0xF0,0x55,0xAA,0x52,0x08,0x05};
	char h1[] = {0xB0,0x33,0x03,0x00,0x03};
	char i1[] = {0xB1,0x30,0x00};
	char j1[] = {0xB2,0x03,0x01,0x00};
	char k1[] = {0xB3,0x82,0x00,0x81,0x38};
	char l1[] = {0xB4,0xD5,0x75,0x07,0x57};
	char n1[] = {0xB6,0x01,0x00,0xD5,0x71,0x07,0x57};
	char m1[] = {0xB9,0x09,0x00,0x00,0x05,0x00};
	char o1[] = {0xC0,0x75,0x07,0x00,0x57,0x05};
	char p1[] = {0xC6,0x20};
	char r1[] = {0xD0,0x00,0x25,0x01,0x00,0x00};
	char s1[] = {0xD1,0x00,0x25,0x02,0x00,0x00};
	char t1[] = {0xF0,0x55,0xAA,0x52,0x08,0x06};
	char u1[] = {0xB0,0x32,0x32,0x02,0x02,0x03};
	char v1[] = {0xB1,0x03,0x33,0x33,0x08,0x3D};
	char w1[] = {0xB2,0x0A,0x0A,0x3D,0x17,0x17};
	char x1[] = {0xB3,0x16,0x16,0x19,0x19,0x18};
	char y1[] = {0xB4,0x18,0x33};
	char z1[] = {0xB5,0x32,0x32,0x00,0x00,0x01};
	char a2[] = {0xB6,0x01,0x33,0x33,0x08,0x3D};
	char b2[] = {0xB7,0x0A,0x0A,0x3D,0x11,0x11};
	char c2[] = {0xB8,0x10,0x10,0x13,0x13,0x12};
	char d2[] = {0xB9,0x12,0x33};
	char e2[] = {0xFF,0xAA,0x55,0xA5,0x80};
	char f2[] = {0x6F,0x08};
	char g2[] = {0xFC,0x00};
	char h2[] = {0x6F,0x09};
	char i2[] = {0xF7,0x82};
	char j2[] = {0x6F,0x0B};
	char k2[] = {0xF7,0xE0};
	mdelay(100);
	send_long_cmd(a, 6);	
	send_long_cmd(b, 2);	
	send_long_cmd(c, 3);	
	send_long_cmd(d, 3);	
	send_long_cmd(e, 5);	
	send_long_cmd(f, 2);	
	send_long_cmd(g, 6);	
	send_long_cmd(h, 2);	
	send_long_cmd(i, 2);	
	send_long_cmd(j, 2);	
	send_long_cmd(k, 3);	
	send_long_cmd(l, 3);	
	send_long_cmd(n3, 4);	
	send_long_cmd(m, 2);	
	send_long_cmd(o, 2);	
	send_long_cmd(p, 6);	
	send_long_cmd(q, 2);	
	send_long_cmd(r, 17);	
	send_long_cmd(s, 17);	
	send_long_cmd(t, 17);	
	send_long_cmd(u, 5);	
	send_long_cmd(v, 6);	
	send_long_cmd(w, 5);	
	send_long_cmd(x, 5);	
	send_long_cmd(y, 8);	
	send_long_cmd(z, 8);	
	send_long_cmd(a1, 11);	
	send_long_cmd(b1, 11);	
	send_long_cmd(c1, 8);	
	send_long_cmd(d1, 8);	
	send_long_cmd(e1, 3);	
	send_long_cmd(f1, 3);	
	send_long_cmd(g1, 6);	
	send_long_cmd(h1, 5);	
	send_long_cmd(i1, 3);	
	send_long_cmd(j1, 4);	
	send_long_cmd(k1, 5);	
	send_long_cmd(l1, 5);	
	send_long_cmd(n1, 7);	
	send_long_cmd(m1, 6);	
	send_long_cmd(o1, 6);	
	send_long_cmd(p1, 2);	
	send_long_cmd(r1, 6);	
	send_long_cmd(s1, 6);	
	send_long_cmd(t1, 6);	
	send_long_cmd(u1, 6);	
	send_long_cmd(v1, 6);	
	send_long_cmd(w1, 6);	
	send_long_cmd(x1, 6);	
	send_long_cmd(y1, 3);	
	send_long_cmd(z1, 6);	
	send_long_cmd(a2, 6);	
	send_long_cmd(b2, 6);	
	send_long_cmd(c2, 6);	
	send_long_cmd(d2, 3);	
	send_long_cmd(e2, 5);	
	send_long_cmd(f2, 2);	
	send_long_cmd(g2, 2);	
	send_long_cmd(h2, 2);	
	send_long_cmd(i2, 2);	
	send_long_cmd(j2, 2);	
	send_long_cmd(k2, 2);	
	send_short_cmd(0x11);
	mdelay(120);
	send_short_cmd(0x29);
}

